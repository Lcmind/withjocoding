<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Free Memory Test Game! Test your memory skills with card matching. Multiple difficulty levels, track your records!">
  <title>Memory Test - Card Matching Game | Brain Training</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#667eea',
            secondary: '#764ba2',
          }
        }
      }
    }
  </script>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1247545232353663"
     crossorigin="anonymous"></script>

  <style>
    /* ê²Œì„ ê³ ìœ  ìŠ¤íƒ€ì¼ */
    .card {
      perspective: 1000px;
    }
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-back {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 overflow-x-hidden">

  <!-- ì–¸ì–´ ì„ íƒ -->
  <div class="fixed top-4 right-4 z-50">
    <select id="language-selector" class="px-4 py-2 rounded-lg bg-white/90 backdrop-blur-sm shadow-lg border-2 border-white/50 cursor-pointer hover:bg-white transition-all">
      <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
      <option value="en">ğŸ‡ºğŸ‡¸ English</option>
      <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
    </select>
  </div>

  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="start-screen" class="screen active min-h-screen flex flex-col items-center justify-center p-4 md:p-8">
    <div class="max-w-4xl w-full">

      <!-- ìƒë‹¨ ê´‘ê³  -->
      <div class="mb-6 flex justify-center">
        <ins class="adsbygoogle block"
             style="display:block; max-height:90px;"
             data-ad-format="horizontal"
             data-ad-client="ca-pub-1247545232353663"
             data-full-width-responsive="true"></ins>
      </div>

      <!-- ë©”ì¸ ì¹´ë“œ -->
      <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-10">
        <h1 class="text-4xl md:text-6xl font-bold text-center text-blue-600 mb-4">
          ğŸ§  <span data-i18n="title">Memory Test</span>
        </h1>
        <p class="text-lg md:text-xl text-center text-gray-600 mb-8" data-i18n="subtitle">Match all cards in the shortest time!</p>

        <!-- ê²Œì„ ë°©ë²• -->
        <div class="bg-gray-50 rounded-2xl p-6 mb-8">
          <h3 class="text-xl font-bold text-blue-600 mb-4" data-i18n="gameMethod">How to Play</h3>
          <ol class="list-decimal list-inside space-y-2 text-gray-700">
            <li data-i18n="gameMethod0">Click cards to flip and reveal emojis</li>
            <li data-i18n="gameMethod1">Find matching pairs of emojis</li>
            <li data-i18n="gameMethod2">Match all pairs in the shortest time to win!</li>
          </ol>
        </div>

      <!-- ë‚œì´ë„ ì„ íƒ -->
      <div class="mb-8">
        <h3 class="text-xl font-bold text-center mb-4" data-i18n="selectDifficulty">Select Difficulty</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <button class="difficulty-btn border-2 border-gray-300 rounded-xl p-6 hover:border-blue-500 hover:shadow-lg transition-all" data-difficulty="easy">
            <div class="text-3xl mb-2">ğŸ˜Š</div>
            <div class="font-bold text-lg" data-i18n="easy">Easy</div>
            <div class="text-sm text-gray-500">4x3 (6 pairs)</div>
          </button>
          <button class="difficulty-btn active border-2 border-blue-500 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-xl p-6 shadow-lg" data-difficulty="normal">
            <div class="text-3xl mb-2">ğŸ¤”</div>
            <div class="font-bold text-lg" data-i18n="normal">Normal</div>
            <div class="text-sm opacity-90">4x4 (8 pairs)</div>
          </button>
          <button class="difficulty-btn border-2 border-gray-300 rounded-xl p-6 hover:border-blue-500 hover:shadow-lg transition-all" data-difficulty="hard">
            <div class="text-3xl mb-2">ğŸ¤¯</div>
            <div class="font-bold text-lg" data-i18n="hard">Hard</div>
            <div class="text-sm text-gray-500">6x4 (12 pairs)</div>
          </button>
        </div>
      </div>

      <button id="start-btn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold text-xl py-4 rounded-full shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all">
        <span data-i18n="startGame">Start Game</span>
      </button>

      <div class="mt-6 text-center text-gray-600">
        <p>ğŸ† <span data-i18n="myBestRecord">My Best Record</span>: <span id="best-record">--</span></p>
      </div>

      <!-- ë‚´ ê¸°ë¡ TOP 10 -->
      <div class="mt-8">
        <h3 class="text-xl font-bold text-center mb-4">ğŸ“Š <span data-i18n="myRecordsTop10">My Top 10 Records</span></h3>
        <div id="history-list" class="bg-gray-50 rounded-2xl p-4 max-h-80 overflow-y-auto">
          <p class="text-center text-gray-500 py-8" data-i18n="noRecordsYet">No records yet. Start now!</p>
        </div>
      </div>

      <!-- ë‹¤ë¥¸ ê²Œì„ ì„¹ì…˜ -->
      <div class="mt-8 border-t border-gray-200 pt-8">
        <h3 class="text-xl font-bold text-center mb-4">ğŸ® <span data-i18n="otherGames">Other Games</span></h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- FPS ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸ -->
          <a href="index.html" class="block bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl p-6 text-white hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="text-3xl mb-2">ğŸ¯</div>
            <div class="font-bold text-lg mb-2">FPS Reaction Time</div>
            <div class="text-sm opacity-90">Test your reflexes</div>
          </a>

          <!-- íƒ€ì´í•‘ ì†ë„ -->
          <a href="typing-speed.html" class="block bg-gradient-to-br from-green-500 to-teal-600 rounded-xl p-6 text-white hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="text-3xl mb-2">âš¡</div>
            <div class="font-bold text-lg mb-2" data-i18n="typingSpeed">Typing Speed</div>
            <div class="text-sm opacity-90" data-i18n="typingSpeedDesc">Test your typing speed</div>
          </a>

          <!-- ì¡°ì¤€ íŠ¸ë ˆì´ë„ˆ -->
          <a href="aim-trainer.html" class="block bg-gradient-to-br from-orange-500 to-red-600 rounded-xl p-6 text-white hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="text-3xl mb-2">ğŸ¯</div>
            <div class="font-bold text-lg mb-2" data-i18n="aimTrainer">Aim Trainer</div>
            <div class="text-sm opacity-90" data-i18n="aimTrainerDesc">Improve your aim precision</div>
          </a>

          <!-- ìˆ˜í•™ ì±Œë¦°ì§€ -->
          <a href="math-challenge.html" class="block bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl p-6 text-white hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="text-3xl mb-2">ğŸ”¢</div>
            <div class="font-bold text-lg mb-2" data-i18n="mathChallenge">Math Challenge</div>
            <div class="text-sm opacity-90" data-i18n="mathChallengeDesc">Quick math calculations</div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- ê²Œì„ í™”ë©´ -->
  <div id="game-screen" class="screen hidden min-h-screen flex flex-col items-center justify-center p-4 bg-gray-900/50">
    <!-- ê²Œì„ ì •ë³´ -->
    <div class="mb-4 flex gap-4 bg-white/90 backdrop-blur-md px-6 py-3 rounded-full shadow-lg">
      <div class="text-gray-700 font-bold">
        â±ï¸ <span id="time-display">0:00</span>
      </div>
      <div class="text-gray-700 font-bold">
        ğŸ”„ <span id="moves-display">0</span> <span data-i18n="moves">moves</span>
      </div>
    </div>

    <!-- ì¹´ë“œ ê·¸ë¦¬ë“œ -->
    <div id="card-grid" class="grid gap-3 mb-4"></div>
  </div>

  <!-- ê²°ê³¼ í™”ë©´ -->
  <div id="result-screen" class="screen hidden min-h-screen flex flex-col items-center justify-center p-4">
    <div class="max-w-2xl w-full bg-white rounded-3xl shadow-2xl p-6 md:p-10">
      <h1 class="text-4xl font-bold text-center text-blue-600 mb-8">
        ğŸ‰ <span data-i18n="complete">Complete!</span>
      </h1>

      <div class="bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-2xl p-8 mb-6">
        <div class="text-center">
          <div class="text-lg opacity-90 mb-2" data-i18n="yourTime">Your Time</div>
          <div id="final-time" class="text-5xl font-bold mb-4">0:00</div>
          <div id="final-moves" class="text-xl">0 moves</div>
        </div>
      </div>

      <div class="flex gap-4 mb-6">
        <button id="retry-btn" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold text-xl py-4 rounded-full shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all">
          <span data-i18n="playAgain">Play Again</span>
        </button>
        <button id="home-btn" class="flex-1 bg-white text-blue-600 border-2 border-blue-600 font-bold text-xl py-4 rounded-full hover:bg-blue-600 hover:text-white transition-all">
          <span data-i18n="backHome">Home</span>
        </button>
      </div>
    </div>

    <!-- í•˜ë‹¨ ê´‘ê³  -->
    <div class="mt-6 flex justify-center">
      <ins class="adsbygoogle block"
           style="display:block; min-height:250px;"
           data-ad-format="autorelaxed"
           data-ad-client="ca-pub-1247545232353663"
           data-full-width-responsive="true"></ins>
    </div>
  </div>

  <!-- Footer -->
  <footer class="w-full py-4 text-center text-gray-500 text-sm">
    <p class="mb-1">Made with â¤ï¸ | Memory Test</p>
    <p class="text-xs">
      <a href="privacy.html" class="text-gray-500 hover:text-gray-700 mx-2" data-i18n="privacyPolicy">Privacy Policy</a> |
      <a href="terms.html" class="text-gray-500 hover:text-gray-700 mx-2" data-i18n="termsOfService">Terms of Service</a>
    </p>
  </footer>

  <!-- AdSense ì´ˆê¸°í™” -->
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
    // ë²ˆì—­
    const translations = {
      ko: {
        title: 'ê¸°ì–µë ¥ í…ŒìŠ¤íŠ¸',
        subtitle: 'ëª¨ë“  ì¹´ë“œë¥¼ ìµœë‹¨ ì‹œê°„ì— ë§ì¶°ë³´ì„¸ìš”!',
        gameMethod: 'ê²Œì„ ë°©ë²•',
        gameMethod0: 'ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ë’¤ì§‘ê³  ì´ëª¨ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”',
        gameMethod1: 'ì¼ì¹˜í•˜ëŠ” ì´ëª¨ì§€ ìŒì„ ì°¾ìœ¼ì„¸ìš”',
        gameMethod2: 'ëª¨ë“  ìŒì„ ìµœë‹¨ ì‹œê°„ì— ë§ì¶° ìŠ¹ë¦¬í•˜ì„¸ìš”!',
        selectDifficulty: 'ë‚œì´ë„ ì„ íƒ',
        easy: 'ì‰¬ì›€',
        normal: 'ë³´í†µ',
        hard: 'ì–´ë ¤ì›€',
        startGame: 'ê²Œì„ ì‹œì‘',
        myBestRecord: 'ë‚´ ìµœê³  ê¸°ë¡',
        myRecordsTop10: 'ë‚´ TOP 10 ê¸°ë¡',
        noRecordsYet: 'ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì‹œì‘í•˜ì„¸ìš”!',
        moves: 'ì´ë™',
        complete: 'ì™„ë£Œ!',
        yourTime: 'ì†Œìš” ì‹œê°„',
        playAgain: 'ë‹¤ì‹œ í•˜ê¸°',
        backHome: 'í™ˆìœ¼ë¡œ',
        otherGames: 'ë‹¤ë¥¸ ê²Œì„',
        memoryTest: 'ê¸°ì–µë ¥ í…ŒìŠ¤íŠ¸',
        memoryTestDesc: 'ê¸°ì–µë ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”',
        typingSpeed: 'íƒ€ì´í•‘ ì†ë„',
        typingSpeedDesc: 'íƒ€ì´í•‘ ì†ë„ë¥¼ ì¸¡ì •í•˜ì„¸ìš”',
        aimTrainer: 'ì¡°ì¤€ íŠ¸ë ˆì´ë„ˆ',
        aimTrainerDesc: 'ì¡°ì¤€ ì •í™•ë„ë¥¼ í–¥ìƒì‹œí‚¤ì„¸ìš”',
        mathChallenge: 'ìˆ˜í•™ ì±Œë¦°ì§€',
        mathChallengeDesc: 'ë¹ ë¥¸ ì•”ì‚° ëŠ¥ë ¥ í…ŒìŠ¤íŠ¸',
        privacyPolicy: 'ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨',
        termsOfService: 'ì´ìš©ì•½ê´€'
      },
      en: {
        title: 'Memory Test',
        subtitle: 'Match all cards in the shortest time!',
        gameMethod: 'How to Play',
        gameMethod0: 'Click cards to flip and reveal emojis',
        gameMethod1: 'Find matching pairs of emojis',
        gameMethod2: 'Match all pairs in the shortest time to win!',
        selectDifficulty: 'Select Difficulty',
        easy: 'Easy',
        normal: 'Normal',
        hard: 'Hard',
        startGame: 'Start Game',
        myBestRecord: 'My Best Record',
        myRecordsTop10: 'My Top 10 Records',
        noRecordsYet: 'No records yet. Start now!',
        moves: 'moves',
        complete: 'Complete!',
        yourTime: 'Your Time',
        playAgain: 'Play Again',
        backHome: 'Home',
        otherGames: 'Other Games',
        memoryTest: 'Memory Test',
        memoryTestDesc: 'Test your memory skills',
        typingSpeed: 'Typing Speed',
        typingSpeedDesc: 'Test your typing speed',
        aimTrainer: 'Aim Trainer',
        aimTrainerDesc: 'Improve your aim precision',
        mathChallenge: 'Math Challenge',
        mathChallengeDesc: 'Quick math calculations',
        privacyPolicy: 'Privacy Policy',
        termsOfService: 'Terms of Service'
      },
      ja: {
        title: 'ãƒ¡ãƒ¢ãƒªãƒ¼ãƒ†ã‚¹ãƒˆ',
        subtitle: 'æœ€çŸ­æ™‚é–“ã§å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒãƒƒãƒã•ã›ã‚ˆã†ï¼',
        gameMethod: 'éŠã³æ–¹',
        gameMethod0: 'ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çµµæ–‡å­—ã‚’ç¢ºèª',
        gameMethod1: 'ä¸€è‡´ã™ã‚‹çµµæ–‡å­—ã®ãƒšã‚¢ã‚’è¦‹ã¤ã‘ã‚‹',
        gameMethod2: 'å…¨ã¦ã®ãƒšã‚¢ã‚’æœ€çŸ­æ™‚é–“ã§ãƒãƒƒãƒã—ã¦å‹åˆ©ï¼',
        selectDifficulty: 'é›£æ˜“åº¦é¸æŠ',
        easy: 'ã‚¤ãƒ¼ã‚¸ãƒ¼',
        normal: 'ãƒãƒ¼ãƒãƒ«',
        hard: 'ãƒãƒ¼ãƒ‰',
        startGame: 'ã‚²ãƒ¼ãƒ é–‹å§‹',
        myBestRecord: 'è‡ªå·±ãƒ™ã‚¹ãƒˆè¨˜éŒ²',
        myRecordsTop10: 'TOP 10 è¨˜éŒ²',
        noRecordsYet: 'ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šã™ãå§‹ã‚ã‚ˆã†ï¼',
        moves: 'ç§»å‹•',
        complete: 'å®Œäº†ï¼',
        yourTime: 'æ‰€è¦æ™‚é–“',
        playAgain: 'ã‚‚ã†ä¸€åº¦',
        backHome: 'ãƒ›ãƒ¼ãƒ ',
        otherGames: 'ä»–ã®ã‚²ãƒ¼ãƒ ',
        memoryTest: 'ãƒ¡ãƒ¢ãƒªãƒ¼ãƒ†ã‚¹ãƒˆ',
        memoryTestDesc: 'è¨˜æ†¶åŠ›ã‚’ãƒ†ã‚¹ãƒˆ',
        typingSpeed: 'ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€Ÿåº¦',
        typingSpeedDesc: 'ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€Ÿåº¦ã‚’æ¸¬å®š',
        aimTrainer: 'ã‚¨ã‚¤ãƒ ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼',
        aimTrainerDesc: 'ç…§æº–ç²¾åº¦ã‚’å‘ä¸Š',
        mathChallenge: 'æ•°å­¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸',
        mathChallengeDesc: 'æš—ç®—èƒ½åŠ›ãƒ†ã‚¹ãƒˆ',
        privacyPolicy: 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼',
        termsOfService: 'åˆ©ç”¨è¦ç´„'
      }
    };

    // ê²Œì„ ë¡œì§ ë³€ìˆ˜ ë¨¼ì € ì„ ì–¸
    let difficulty = 'normal';
    let currentLang = 'en';
    
    try {
      currentLang = localStorage.getItem('preferredLanguage') || 'en';
    } catch (e) {
      console.warn('LocalStorage access failed:', e);
    }
    
    const languageSelector = document.getElementById('language-selector');
    if (languageSelector) languageSelector.value = currentLang;

    function t(key) {
      return translations[currentLang][key] || key;
    }

    function updateLanguage() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
      });
      if (typeof loadBestRecord === 'function') loadBestRecord();
      if (typeof loadHistory === 'function') loadHistory();
    }

    if (languageSelector) {
      languageSelector.addEventListener('change', (e) => {
        currentLang = e.target.value;
        try {
          localStorage.setItem('preferredLanguage', currentLang);
        } catch (e) {
          console.warn('LocalStorage save failed:', e);
        }
        updateLanguage();
      });
    }

    // ê²Œì„ ë¡œì§

    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let startTime = 0;
    let timerInterval = null;

    // ì´ëª¨ì§€ í’€ (ë§¤ë²ˆ ëœë¤)
    const emojiPool = ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸŠ', 'ğŸ“', 'ğŸ’', 'ğŸ‘', 'ğŸ¥', 'ğŸ¥‘', 'ğŸ', 'ğŸ¥¥', 'ğŸ‰', 'ğŸˆ', 'ğŸ‹', 'ğŸ¥­', 'ğŸ«', 'ğŸ', 'ğŸ', 'ğŸ¥•', 'ğŸŒ½', 'ğŸ¥¦', 'ğŸ¥’', 'ğŸŒ¶ï¸', 'ğŸ«‘', 'ğŸ¥¬', 'ğŸ§„', 'ğŸ§…', 'ğŸ„', 'ğŸ¥œ', 'ğŸŒ°'];

    const difficultySettings = {
      easy: { pairs: 6, cols: 4 },
      normal: { pairs: 8, cols: 4 },
      hard: { pairs: 12, cols: 6 }
    };

    // ë‚œì´ë„ ì„ íƒ
    document.querySelectorAll('.difficulty-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.difficulty-btn').forEach(b => {
          b.classList.remove('active', 'border-blue-500', 'bg-gradient-to-br', 'from-blue-500', 'to-purple-600', 'text-white', 'shadow-lg');
          b.classList.add('border-gray-300');
        });
        btn.classList.remove('border-gray-300');
        btn.classList.add('active', 'border-blue-500', 'bg-gradient-to-br', 'from-blue-500', 'to-purple-600', 'text-white', 'shadow-lg');
        difficulty = btn.dataset.difficulty;
        loadBestRecord();
        loadHistory();
      });
    });

    const startBtn = document.getElementById('start-btn');
    if (startBtn) {
      startBtn.addEventListener('click', startGame);
    }

    document.getElementById('retry-btn').addEventListener('click', () => {
      hideScreen(document.getElementById('result-screen'));
      showScreen(document.getElementById('start-screen'));
    });
    document.getElementById('home-btn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    function startGame() {
      try {
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');

        if (!startScreen || !gameScreen) {
          throw new Error('Screen elements not found');
        }

        console.log('ğŸ® Before transition:');
        console.log('Start screen classes:', startScreen.className);
        console.log('Game screen classes:', gameScreen.className);

        hideScreen(startScreen);
        showScreen(gameScreen);

        console.log('ğŸ® After transition:');
        console.log('Start screen classes:', startScreen.className);
        console.log('Game screen classes:', gameScreen.className);
        console.log('Game screen computed display:', window.getComputedStyle(gameScreen).display);
        console.log('Game screen position:', window.getComputedStyle(gameScreen).position);

        initGame();
      } catch (e) {
        console.error('Error starting game:', e);
        alert('Game Error: ' + e.message);
      }
    }

    function initGame() {
      const settings = difficultySettings[difficulty];
      cards = [];
      flippedCards = [];
      matchedPairs = 0;
      moves = 0;
      startTime = Date.now();

      // ëœë¤ ì´ëª¨ì§€ ì„ íƒ
      const shuffledEmojis = [...emojiPool].sort(() => Math.random() - 0.5);
      const selectedEmojis = shuffledEmojis.slice(0, settings.pairs);

      // ì¹´ë“œ ìƒì„± (ê° ì´ëª¨ì§€ 2ê°œì”©)
      const cardValues = [...selectedEmojis, ...selectedEmojis];
      cardValues.sort(() => Math.random() - 0.5);

      cards = cardValues.map((emoji, index) => ({
        id: index,
        emoji: emoji,
        flipped: false,
        matched: false
      }));

      renderCards();
      startTimer();
      updateMoves();
    }

    function renderCards() {
      const settings = difficultySettings[difficulty];
      const grid = document.getElementById('card-grid');
      if (!grid) {
        return;
      }
      grid.innerHTML = '';
      grid.className = `grid gap-6 mb-4 max-w-4xl mx-auto`;
      grid.style.gridTemplateColumns = `repeat(${settings.cols}, minmax(100px, 1fr))`;

      cards.forEach(card => {
        const cardEl = document.createElement('div');
        cardEl.className = 'card cursor-pointer aspect-square min-w-[100px] min-h-[100px]';
        cardEl.innerHTML = `
          <div class="card-inner w-full h-full">
            <div class="card-front bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg rounded-2xl">
              <div class="text-6xl md:text-7xl">ğŸ´</div>
            </div>
            <div class="card-back bg-white shadow-lg rounded-2xl border-4 border-blue-400">
              <div class="text-6xl md:text-7xl">${card.emoji}</div>
            </div>
          </div>
        `;

        cardEl.addEventListener('click', () => flipCard(card, cardEl));
        grid.appendChild(cardEl);
      });
    }

    function flipCard(card, cardEl) {
      if (card.flipped || card.matched || flippedCards.length >= 2) return;

      card.flipped = true;
      cardEl.classList.add('flipped');
      flippedCards.push({ card, cardEl });

      if (flippedCards.length === 2) {
        moves++;
        updateMoves();
        checkMatch();
      }
    }

    function checkMatch() {
      const [first, second] = flippedCards;

      if (first.card.emoji === second.card.emoji) {
        // ë§¤ì¹˜!
        first.card.matched = true;
        second.card.matched = true;
        matchedPairs++;
        flippedCards = [];

        if (matchedPairs === difficultySettings[difficulty].pairs) {
          setTimeout(endGame, 500);
        }
      } else {
        // ë¶ˆì¼ì¹˜
        setTimeout(() => {
          first.card.flipped = false;
          second.card.flipped = false;
          first.cardEl.classList.remove('flipped');
          second.cardEl.classList.remove('flipped');
          flippedCards = [];
        }, 1000);
      }
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('time-display').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function updateMoves() {
      document.getElementById('moves-display').textContent = moves;
    }

    function endGame() {
      stopTimer();
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;

      document.getElementById('final-time').textContent = timeStr;
      document.getElementById('final-moves').textContent = `${moves} ${t('moves')}`;

      try {
        // ìµœê³  ê¸°ë¡ ì €ì¥
        const key = `memoryBest_${difficulty}`;
        const best = localStorage.getItem(key);
        if (!best || elapsed < parseInt(best)) {
          localStorage.setItem(key, elapsed);
        }

        // ê¸°ë¡ íˆìŠ¤í† ë¦¬ ì €ì¥
        const historyKey = `memoryHistory_${difficulty}`;
        let history = JSON.parse(localStorage.getItem(historyKey) || '[]');
        history.push({ time: elapsed, moves: moves, date: new Date().toISOString() });
        history.sort((a, b) => a.time - b.time);
        history = history.slice(0, 10); // TOP 10ë§Œ ìœ ì§€
        localStorage.setItem(historyKey, JSON.stringify(history));
      } catch (e) {
        console.warn('LocalStorage save failed:', e);
      }

      hideScreen(document.getElementById('game-screen'));
      showScreen(document.getElementById('result-screen'));
    }

    function showScreen(screen) {
      screen.classList.remove('hidden');
      screen.classList.add('active');
    }

    function hideScreen(screen) {
      screen.classList.add('hidden');
      screen.classList.remove('active');
    }

    // ìµœê³  ê¸°ë¡ ë¡œë“œ
    function loadBestRecord() {
      const key = `memoryBest_${difficulty}`;
      try {
        const best = localStorage.getItem(key);
        if (best) {
          const minutes = Math.floor(best / 60);
          const seconds = best % 60;
          document.getElementById('best-record').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        } else {
          document.getElementById('best-record').textContent = '--';
        }
      } catch (e) {
        console.warn('LocalStorage access failed:', e);
        document.getElementById('best-record').textContent = '--';
      }
    }

    // ê¸°ë¡ íˆìŠ¤í† ë¦¬ ë¡œë“œ
    function loadHistory() {
      const historyKey = `memoryHistory_${difficulty}`;
      let history = [];
      try {
        history = JSON.parse(localStorage.getItem(historyKey) || '[]');
      } catch (e) {
        console.warn('LocalStorage access failed:', e);
      }
      const historyList = document.getElementById('history-list');

      if (history.length === 0) {
        historyList.innerHTML = `<p class="text-center text-gray-500 py-8" data-i18n="noRecordsYet">${t('noRecordsYet')}</p>`;
      } else {
        historyList.innerHTML = history.map((record, index) => {
          const minutes = Math.floor(record.time / 60);
          const seconds = record.time % 60;
          const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
          const date = new Date(record.date);
          const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;

          return `
            <div class="flex items-center justify-between p-3 ${index === 0 ? 'bg-yellow-50 border-2 border-yellow-300' : 'bg-white'} rounded-lg mb-2">
              <div class="flex items-center gap-3">
                <span class="text-2xl font-bold ${index === 0 ? 'text-yellow-600' : 'text-gray-400'}">#${index + 1}</span>
                <div>
                  <div class="font-bold ${index === 0 ? 'text-yellow-700' : 'text-gray-700'}">${timeStr}</div>
                  <div class="text-sm text-gray-500">${record.moves} ${t('moves')} â€¢ ${dateStr}</div>
                </div>
              </div>
              ${index === 0 ? '<span class="text-2xl">ğŸ†</span>' : ''}
            </div>
          `;
        }).join('');
      }
    }

    // ì´ˆê¸° ë¡œë“œ
    updateLanguage();
    loadBestRecord();
    loadHistory();
    }); // DOMContentLoaded
  </script>
</body>
</html>
